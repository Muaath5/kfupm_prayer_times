<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="description" content="مواقيت الصلاة الدقيقة لجامعة الملك فهد للبترول والمعادن (KFUPM) في الظهران، المملكة العربية السعودية - Prayer times for King Fahd University of Petroleum and Minerals">
    <meta name="keywords" content="مواقيت الصلاة, KFUPM, جامعة الملك فهد, الظهران, Prayer Times, Dhahran, Saudi Arabia">
    <meta name="author" content="KFUPM">
    <meta name="robots" content="index, follow">
    <meta property="og:title" content="مواقيت الصلاة - KFUPM">
    <meta property="og:description" content="مواقيت الصلاة الدقيقة لجامعة الملك فهد للبترول والمعادن">
    <meta property="og:type" content="website">
    <meta name="twitter:card" content="summary">
    <meta name="twitter:title" content="مواقيت الصلاة - KFUPM">
    <meta name="twitter:description" content="مواقيت الصلاة الدقيقة لجامعة الملك فهد للبترول والمعادن">
    <link rel="icon" type="image/svg+xml" href="/kfupm_logo.svg">
    <link rel="shortcut icon" type="image/svg+xml" href="/kfupm_logo.svg">
    <title>مواقيت الصلاة - KFUPM</title>
    <link href="https://fonts.googleapis.com/css2?family=IBM+Plex+Sans+Arabic:wght@400;700&display=swap" rel="stylesheet">
    <style>
        :root {
            --primary-green: #008540;
            --secondary-green: #00573F;
            --tertiary-green: #003E51;
            --gold: #DAC961;
            --dark-gold: #AA8A00;
            --light-gray: #D9DAE4;
            --dark-gray: #373938;
            --white: #FFFFFF;
        }
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body { font-family: 'IBM Plex Sans Arabic', sans-serif; background: #f5f5f5; color: var(--dark-gray); line-height: 1.4; font-weight: 400; }
        .container { max-width: 800px; margin: 0 auto; padding: 10px; }
        .header { background: var(--primary-green); color: var(--white); padding: 15px; border-radius: 8px; margin-bottom: 10px; text-align: center; }
        .logo { height: 110px; width: auto; }
        .mosque-note { font-size: 0.75rem; opacity: 0.9; margin-bottom: 8px; }
        .date-info { font-size: 0.85rem; opacity: 0.95; margin-bottom: 10px; }
        .current-info { display: grid; grid-template-columns: repeat(3, 1fr); gap: 8px; }
        .info-item { background: rgba(255, 255, 255, 0.15); padding: 8px; border-radius: 5px; text-align: center; }
        .info-label { font-size: 0.75rem; opacity: 0.9; margin-bottom: 3px; }
        .info-value { font-size: 1rem; font-weight: 700; }
        .controls { display: flex; justify-content: space-between; align-items: center; margin-bottom: 10px; gap: 8px; }
        .btn-group { display: flex; gap: 8px; flex-wrap: wrap; }
        .btn { background: var(--primary-green); color: var(--white); border: none; padding: 6px 12px; border-radius: 5px; cursor: pointer; font-size: 0.85rem; font-family: 'IBM Plex Sans Arabic', sans-serif; display: flex; align-items: center; gap: 5px; }
        .btn:hover { background: var(--secondary-green); }
        .btn-secondary { background: var(--primary-green); }
        .btn-secondary:hover { background: var(--secondary-green); }
        .arrow { font-size: 0.7rem; }
        .prayer-table { background: var(--white); border-radius: 8px; overflow: hidden; box-shadow: 0 2px 4px rgba(0,0,0,0.1); margin-bottom: 10px; }
        table { width: 100%; border-collapse: collapse; }
        th { background: var(--primary-green); color: var(--white); padding: 12px 8px; text-align: center; font-weight: 700; font-size: 0.95rem; }
        td { padding: 12px 8px; text-align: center; border-bottom: 1px solid var(--light-gray); font-size: 0.9rem; }
        tr:last-child td { border-bottom: none; }
        tr:hover { background: #f9f9f9; }
        tr.next-prayer { background: var(--gold) !important; }
        tr.next-prayer td { font-weight: 700; }
        .prayer-name { font-weight: 700; font-size: 1rem; color: var(--dark-gray); }
        .time { font-size: 1.05rem; font-weight: 400; color: var(--primary-green); }
        tr.next-prayer .time { color: var(--dark-gray); }
        .advanced-section { background: var(--white); border-radius: 8px; padding: 15px; box-shadow: 0 2px 4px rgba(0,0,0,0.1); margin-bottom: 10px; }
        .advanced-grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(180px, 1fr)); gap: 10px; }
        .advanced-item { padding: 10px; background: #f9f9f9; border-radius: 5px; border-left: 3px solid var(--primary-green); }
        .advanced-label { font-size: 0.8rem; color: var(--dark-gray); margin-bottom: 4px; }
        .advanced-value { font-size: 1rem; font-weight: 700; color: var(--primary-green); }
        .settings-panel { background: var(--white); border-radius: 8px; padding: 15px; box-shadow: 0 2px 4px rgba(0,0,0,0.1); margin-bottom: 10px; position: relative; }
        .settings-header { display: flex; justify-content: space-between; align-items: center; margin-bottom: 12px; }
        .settings-header h3 { color: var(--primary-green); font-size: 1.1rem; font-weight: 700; }
        .close-btn { background: var(--dark-gold); color: var(--white); border: none; width: 28px; height: 28px; border-radius: 50%; cursor: pointer; font-size: 1.2rem; display: flex; align-items: center; justify-content: center; padding: 0; line-height: 1; }
        .close-btn:hover { background: var(--gold); color: var(--dark-gray); }
        .settings-grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(140px, 1fr)); gap: 10px; margin-bottom: 10px; }
        .setting-item { display: flex; flex-direction: column; }
        .setting-label { margin-bottom: 4px; font-weight: 400; font-size: 0.8rem; color: var(--dark-gray); }
        .setting-input { padding: 6px; border: 1px solid var(--light-gray); border-radius: 4px; font-size: 0.85rem; font-family: 'IBM Plex Sans Arabic', sans-serif; }
        .setting-input:focus { outline: none; border-color: var(--primary-green); }
        [dir="ltr"] .advanced-item { border-left: none; border-right: 3px solid var(--primary-green); }
        @media (max-width: 600px) {
            .container { padding: 8px; }
            .header { padding: 12px; }
            .logo { height: 40px; }
            .date-info { font-size: 0.75rem; }
            .info-label { font-size: 0.7rem; }
            .info-value { font-size: 0.9rem; }
            th, td { padding: 10px 4px; font-size: 0.85rem; }
            .prayer-name { font-size: 0.9rem; }
            .time { font-size: 0.95rem; }
            .btn { padding: 5px 10px; font-size: 0.8rem; }
            .advanced-grid { grid-template-columns: 1fr; }
            .settings-grid { grid-template-columns: 1fr 1fr; }
        }
        .hidden { display: none; }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <div class="logo-container">
                <img src="/kfupm_logo.svg" alt="KFUPM Logo" class="logo">
            </div>
            <div class="mosque-note" id="mosqueNote">مسجد علي بن أبي طالب</div>
            <div class="date-info" id="dateInfo"></div>
            <div class="current-info">
                <div class="info-item">
                    <div class="info-label" id="currentTimeLabel">الوقت الحالي</div>
                    <div class="info-value" id="currentTime">--:--:--</div>
                </div>
                <div class="info-item">
                    <div class="info-label" id="nextAthanLabel">بقي للأذان</div>
                    <div class="info-value" id="nextAthan">--:--</div>
                </div>
                <div class="info-item">
                    <div class="info-label" id="nextIqamaLabel">بقي للإقامة</div>
                    <div class="info-value" id="nextIqama">--:--</div>
                </div>
            </div>
        </div>
        <div class="controls">
            <div class="btn-group">
                <button class="btn" id="langBtn" onclick="toggleLanguage()">English</button>
                <button class="btn btn-secondary" id="advancedBtn" onclick="toggleAdvanced()">عرض متقدم</button>
            </div>
            <button class="btn btn-secondary" id="settingsBtn" onclick="toggleSettings()">
                <span id="settingsBtnText">إعدادات</span>
                <span class="arrow" id="settingsArrow">▼</span>
            </button>
        </div>
        <div class="settings-panel hidden" id="settingsPanel">
            <div class="settings-header">
                <h3 id="settingsTitle">الإعدادات</h3>
                <button class="close-btn" onclick="toggleSettings()">×</button>
            </div>
            <div class="setting-item" style="margin-bottom: 10px;">
                <label class="setting-label" id="formatLabel">صيغة الوقت</label>
                <select class="setting-input" id="timeFormat" onchange="saveSettings()">
                    <option value="12">12 ساعة</option>
                    <option value="24">24 ساعة</option>
                </select>
            </div>
            <div class="settings-grid">
                <div class="setting-item">
                    <label class="setting-label" id="fajrLabel">الفجر (د)</label>
                    <input type="number" class="setting-input" id="fajrIqama" value="30" onchange="saveSettings()">
                </div>
                <div class="setting-item">
                    <label class="setting-label" id="dhuhrLabel">الظهر (د)</label>
                    <input type="number" class="setting-input" id="dhuhrIqama" value="20" onchange="saveSettings()">
                </div>
                <div class="setting-item">
                    <label class="setting-label" id="asrLabel">العصر (د)</label>
                    <input type="number" class="setting-input" id="asrIqama" value="20" onchange="saveSettings()">
                </div>
                <div class="setting-item">
                    <label class="setting-label" id="maghribLabel">المغرب (د)</label>
                    <input type="number" class="setting-input" id="maghribIqama" value="15" onchange="saveSettings()">
                </div>
                <div class="setting-item">
                    <label class="setting-label" id="ishaLabel">العشاء (د)</label>
                    <input type="number" class="setting-input" id="ishaIqama" value="20" onchange="saveSettings()">
                </div>
            </div>
        </div>
        <div class="prayer-table">
            <table>
                <thead>
                    <tr>
                        <th id="prayerHeader">الصلاة</th>
                        <th id="athanHeader">الأذان</th>
                        <th id="iqamaHeader">الإقامة</th>
                    </tr>
                </thead>
                <tbody id="prayerTableBody"></tbody>
            </table>
        </div>
        <div class="advanced-section hidden" id="advancedSection">
            <div class="advanced-grid" id="advancedGrid"></div>
        </div>
    </div>
    <script>
// PrayTimes.js: Prayer Times Calculator (ver 2.3)
// Copyright (C) 2007-2011 PrayTimes.org

//--------------------- Help and Manual ----------------------
// User's Manual: 
// http://praytimes.org/manual
//
// Calculation Formulas: 
// http://praytimes.org/calculation

//------------------------ User Interface -------------------------

var prayTimes = new PrayTimes('MWL');

//--------------------- PrayTimes Class ------------------------

function PrayTimes(method) {

	//------------------------ Constants --------------------------
	var
	
	// Time Names
	timeNames = {
		imsak    : 'Imsak',
		fajr     : 'Fajr',
		sunrise  : 'Sunrise',
		dhuhr    : 'Dhuhr',
		asr      : 'Asr',
		sunset   : 'Sunset',
		maghrib  : 'Maghrib',
		isha     : 'Isha',
		midnight : 'Midnight'
	},

	// Calculation Methods
	methods = {
		MWL: {
			name: 'Muslim World League',
			params: { fajr: 18, isha: 17 } },
		ISNA: {
			name: 'Islamic Society of North America (ISNA)',
			params: { fajr: 15, isha: 15 } },
		Egypt: {
			name: 'Egyptian General Authority of Survey',
			params: { fajr: 19.5, isha: 17.5 } },
		Makkah: {
			name: 'Umm Al-Qura University, Makkah',
			params: { fajr: 18.5, isha: '90 min' } },  // fajr was 19 degrees before 1430 hijri
		Karachi: {
			name: 'University of Islamic Sciences, Karachi',
			params: { fajr: 18, isha: 18 } },
		Tehran: {
			name: 'Institute of Geophysics, University of Tehran',
			params: { fajr: 17.7, isha: 14, maghrib: 4.5, midnight: 'Jafari' } },  // isha is not explicitly specified in this method
		Jafari: {
			name: 'Shia Ithna-Ashari, Leva Institute, Qum',
			params: { fajr: 16, isha: 14, maghrib: 4, midnight: 'Jafari' } }
	},

	// Default Parameters in Calculation Methods
	defaultParams = {
		maghrib: '0 min', isha: '0 min', midnight: 'Standard', highLats: 'NightMiddle'
	},

	//----------------------- Parameter Values ----------------------
	/*
	
	// Asr Juristic Methods
	asrJuristics = [ 
		'Standard',    // Shafi`i, Maliki, Ja`fari, Hanbali
		'Hanafi'       // Hanafi
	],

	// Midnight Mode
	midnightMethods = [ 
		'Standard',    // Mid Sunset to Sunrise
		'Jafari'       // Mid Sunset to Fajr
	],

	// Adjust Methods for Higher Latitudes
	highLatMethods = [
		'NightMiddle', // middle of night
		'AngleBased',  // angle/60th of night
		'OneSeventh',  // 1/7th of night
		'None'         // No adjustment
	],

	// Time Formats
	timeFormats = [
		'24h',         // 24-hour format
		'12h',         // 12-hour format
		'12hNS',       // 12-hour format with no suffix
		'Float'        // floating point number 
	],
	*/
	

	//---------------------- Default Settings --------------------
	
	calcMethod = 'MWL',

	// do not change anything here; use adjust method instead
	setting = {  
		imsak    : '10 min',
		dhuhr    : '0 min',  
		asr      : 'Standard',
		highLats : 'NightMiddle'
	},

	timeFormat = '24h',
	timeSuffixes = ['am', 'pm'],
	invalidTime =  '-----',

	numIterations = 1,
	offset = {},


	//----------------------- Local Variables ---------------------

	lat, lng, elv,       // coordinates
	timeZone, jDate;     // time variables
	

	//---------------------- Initialization -----------------------
	
	
	// set methods defaults
	var defParams = defaultParams;
	for (var i in methods) {
		var params = methods[i].params;
		for (var j in defParams)
			if ((typeof(params[j]) == 'undefined'))
				params[j] = defParams[j];
	};

	// initialize settings
	calcMethod = methods[method] ? method : calcMethod;
	var params = methods[calcMethod].params;
	for (var id in params)
		setting[id] = params[id];

	// init time offsets
	for (var i in timeNames)
		offset[i] = 0;

		
	
	//----------------------- Public Functions ------------------------
	return {

	
	// set calculation method 
	setMethod: function(method) {
		if (methods[method]) {
			this.adjust(methods[method].params);
			calcMethod = method;
		}
	},


	// set calculating parameters
	adjust: function(params) {
		for (var id in params)
			setting[id] = params[id];
	},


	// set time offsets
	tune: function(timeOffsets) {
		for (var i in timeOffsets)
			offset[i] = timeOffsets[i];
	},


	// get current calculation method
	getMethod: function() { return calcMethod; },

	// get current setting
	getSetting: function() { return setting; },

	// get current time offsets
	getOffsets: function() { return offset; },

	// get default calc parametrs
	getDefaults: function() { return methods; },


	// return prayer times for a given date
	getTimes: function(date, coords, timezone, dst, format) {
		lat = 1* coords[0];
		lng = 1* coords[1]; 
		elv = coords[2] ? 1* coords[2] : 0;
		timeFormat = format || timeFormat;
		if (date.constructor === Date)
			date = [date.getFullYear(), date.getMonth()+ 1, date.getDate()];
		if (typeof(timezone) == 'undefined' || timezone == 'auto')
			timezone = this.getTimeZone(date);
		if (typeof(dst) == 'undefined' || dst == 'auto') 
			dst = this.getDst(date);
		timeZone = 1* timezone+ (1* dst ? 1 : 0);
		jDate = this.julian(date[0], date[1], date[2])- lng/ (15* 24);
		
		return this.computeTimes();
	},


	// convert float time to the given format (see timeFormats)
	getFormattedTime: function(time, format, suffixes) {
		if (isNaN(time))
			return invalidTime;
		if (format == 'Float') return time;
		suffixes = suffixes || timeSuffixes;

		time = DMath.fixHour(time+ 0.5/ 60);  // add 0.5 minutes to round
		var hours = Math.floor(time); 
		var minutes = Math.floor((time- hours)* 60);
		var suffix = (format == '12h') ? suffixes[hours < 12 ? 0 : 1] : '';
		var hour = (format == '24h') ? this.twoDigitsFormat(hours) : ((hours+ 12 -1)% 12+ 1);
		return hour+ ':'+ this.twoDigitsFormat(minutes)+ (suffix ? ' '+ suffix : '');
	},


	//---------------------- Calculation Functions -----------------------


	// compute mid-day time
	midDay: function(time) {
		var eqt = this.sunPosition(jDate+ time).equation;
		var noon = DMath.fixHour(12- eqt);
		return noon;
	},


	// compute the time at which sun reaches a specific angle below horizon
	sunAngleTime: function(angle, time, direction) {
		var decl = this.sunPosition(jDate+ time).declination;
		var noon = this.midDay(time);
		var t = 1/15* DMath.arccos((-DMath.sin(angle)- DMath.sin(decl)* DMath.sin(lat))/ 
				(DMath.cos(decl)* DMath.cos(lat)));
		return noon+ (direction == 'ccw' ? -t : t);
	},


	// compute asr time 
	asrTime: function(factor, time) { 
		var decl = this.sunPosition(jDate+ time).declination;
		var angle = -DMath.arccot(factor+ DMath.tan(Math.abs(lat- decl)));
		return this.sunAngleTime(angle, time);
	},


	// compute declination angle of sun and equation of time
	// Ref: http://aa.usno.navy.mil/faq/docs/SunApprox.php
	sunPosition: function(jd) {
		var D = jd - 2451545.0;
		var g = DMath.fixAngle(357.529 + 0.98560028* D);
		var q = DMath.fixAngle(280.459 + 0.98564736* D);
		var L = DMath.fixAngle(q + 1.915* DMath.sin(g) + 0.020* DMath.sin(2*g));

		var R = 1.00014 - 0.01671* DMath.cos(g) - 0.00014* DMath.cos(2*g);
		var e = 23.439 - 0.00000036* D;

		var RA = DMath.arctan2(DMath.cos(e)* DMath.sin(L), DMath.cos(L))/ 15;
		var eqt = q/15 - DMath.fixHour(RA);
		var decl = DMath.arcsin(DMath.sin(e)* DMath.sin(L));

		return {declination: decl, equation: eqt};
	},


	// convert Gregorian date to Julian day
	// Ref: Astronomical Algorithms by Jean Meeus
	julian: function(year, month, day) {
		if (month <= 2) {
			year -= 1;
			month += 12;
		};
		var A = Math.floor(year/ 100);
		var B = 2- A+ Math.floor(A/ 4);

		var JD = Math.floor(365.25* (year+ 4716))+ Math.floor(30.6001* (month+ 1))+ day+ B- 1524.5;
		return JD;
	},

	
	//---------------------- Compute Prayer Times -----------------------


	// compute prayer times at given julian date
	computePrayerTimes: function(times) {
		times = this.dayPortion(times);
		var params  = setting;
		
		var imsak   = this.sunAngleTime(this.eval(params.imsak), times.imsak, 'ccw');
		var fajr    = this.sunAngleTime(this.eval(params.fajr), times.fajr, 'ccw');
		var sunrise = this.sunAngleTime(this.riseSetAngle(), times.sunrise, 'ccw');  
		var dhuhr   = this.midDay(times.dhuhr);
		var asr     = this.asrTime(this.asrFactor(params.asr), times.asr);
		var sunset  = this.sunAngleTime(this.riseSetAngle(), times.sunset);;
		var maghrib = this.sunAngleTime(this.eval(params.maghrib), times.maghrib);
		var isha    = this.sunAngleTime(this.eval(params.isha), times.isha);

		return {
			imsak: imsak, fajr: fajr, sunrise: sunrise, dhuhr: dhuhr, 
			asr: asr, sunset: sunset, maghrib: maghrib, isha: isha
		};
	},


	// compute prayer times 
	computeTimes: function() {
		// default times
		var times = { 
			imsak: 5, fajr: 5, sunrise: 6, dhuhr: 12, 
			asr: 13, sunset: 18, maghrib: 18, isha: 18
		};

		// main iterations
		for (var i=1 ; i<=numIterations ; i++) 
			times = this.computePrayerTimes(times);

		times = this.adjustTimes(times);
		
		// add midnight time
		times.midnight = (setting.midnight == 'Jafari') ? 
				times.sunset+ this.timeDiff(times.sunset, times.fajr)/ 2 :
				times.sunset+ this.timeDiff(times.sunset, times.sunrise)/ 2;

		times = this.tuneTimes(times);
		return this.modifyFormats(times);
	},


	// adjust times 
	adjustTimes: function(times) {
		var params = setting;
		for (var i in times)
			times[i] += timeZone- lng/ 15;
			
		if (params.highLats != 'None')
			times = this.adjustHighLats(times);
			
		if (this.isMin(params.imsak))
			times.imsak = times.fajr- this.eval(params.imsak)/ 60;
		if (this.isMin(params.maghrib))
			times.maghrib = times.sunset+ this.eval(params.maghrib)/ 60;
		if (this.isMin(params.isha))
			times.isha = times.maghrib+ this.eval(params.isha)/ 60;
		times.dhuhr += this.eval(params.dhuhr)/ 60; 

		return times;
	},


	// get asr shadow factor
	asrFactor: function(asrParam) {
		var factor = {Standard: 1, Hanafi: 2}[asrParam];
		return factor || this.eval(asrParam);
	},


	// return sun angle for sunset/sunrise
	riseSetAngle: function() {
		//var earthRad = 6371009; // in meters
		//var angle = DMath.arccos(earthRad/(earthRad+ elv));
		var angle = 0.0347* Math.sqrt(elv); // an approximation
		return 0.833+ angle;
	},


	// apply offsets to the times
	tuneTimes: function(times) {
		for (var i in times)
			times[i] += offset[i]/ 60; 
		return times;
	},


	// convert times to given time format
	modifyFormats: function(times) {
		for (var i in times)
			times[i] = this.getFormattedTime(times[i], timeFormat); 
		return times;
	},


	// adjust times for locations in higher latitudes
	adjustHighLats: function(times) {
		var params = setting;
		var nightTime = this.timeDiff(times.sunset, times.sunrise); 

		times.imsak = this.adjustHLTime(times.imsak, times.sunrise, this.eval(params.imsak), nightTime, 'ccw');
		times.fajr  = this.adjustHLTime(times.fajr, times.sunrise, this.eval(params.fajr), nightTime, 'ccw');
		times.isha  = this.adjustHLTime(times.isha, times.sunset, this.eval(params.isha), nightTime);
		times.maghrib = this.adjustHLTime(times.maghrib, times.sunset, this.eval(params.maghrib), nightTime);
		
		return times;
	},

	
	// adjust a time for higher latitudes
	adjustHLTime: function(time, base, angle, night, direction) {
		var portion = this.nightPortion(angle, night);
		var timeDiff = (direction == 'ccw') ? 
			this.timeDiff(time, base):
			this.timeDiff(base, time);
		if (isNaN(time) || timeDiff > portion) 
			time = base+ (direction == 'ccw' ? -portion : portion);
		return time;
	},

	
	// the night portion used for adjusting times in higher latitudes
	nightPortion: function(angle, night) {
		var method = setting.highLats;
		var portion = 1/2 // MidNight
		if (method == 'AngleBased')
			portion = 1/60* angle;
		if (method == 'OneSeventh')
			portion = 1/7;
		return portion* night;
	},


	// convert hours to day portions 
	dayPortion: function(times) {
		for (var i in times)
			times[i] /= 24;
		return times;
	},


	//---------------------- Time Zone Functions -----------------------


	// get local time zone
	getTimeZone: function(date) {
		var year = date[0];
		var t1 = this.gmtOffset([year, 0, 1]);
		var t2 = this.gmtOffset([year, 6, 1]);
		return Math.min(t1, t2);
	},

	
	// get daylight saving for a given date
	getDst: function(date) {
		return 1* (this.gmtOffset(date) != this.getTimeZone(date));
	},


	// GMT offset for a given date
	gmtOffset: function(date) {
		var localDate = new Date(date[0], date[1]- 1, date[2], 12, 0, 0, 0);
		var GMTString = localDate.toGMTString();
		var GMTDate = new Date(GMTString.substring(0, GMTString.lastIndexOf(' ')- 1));
		var hoursDiff = (localDate- GMTDate) / (1000* 60* 60);
		return hoursDiff;
	},

	
	//---------------------- Misc Functions -----------------------

	// convert given string into a number
	eval: function(str) {
		return 1* (str+ '').split(/[^0-9.+-]/)[0];
	},


	// detect if input contains 'min'
	isMin: function(arg) {
		return (arg+ '').indexOf('min') != -1;
	},


	// compute the difference between two times 
	timeDiff: function(time1, time2) {
		return DMath.fixHour(time2- time1);
	},


	// add a leading 0 if necessary
	twoDigitsFormat: function(num) {
		return (num <10) ? '0'+ num : num;
	}
	
}}



//---------------------- Degree-Based Math Class -----------------------


var DMath = {

	dtr: function(d) { return (d * Math.PI) / 180.0; },
	rtd: function(r) { return (r * 180.0) / Math.PI; },

	sin: function(d) { return Math.sin(this.dtr(d)); },
	cos: function(d) { return Math.cos(this.dtr(d)); },
	tan: function(d) { return Math.tan(this.dtr(d)); },

	arcsin: function(d) { return this.rtd(Math.asin(d)); },
	arccos: function(d) { return this.rtd(Math.acos(d)); },
	arctan: function(d) { return this.rtd(Math.atan(d)); },

	arccot: function(x) { return this.rtd(Math.atan(1/x)); },
	arctan2: function(y, x) { return this.rtd(Math.atan2(y, x)); },

	fixAngle: function(a) { return this.fix(a, 360); },
	fixHour:  function(a) { return this.fix(a, 24 ); },

	fix: function(a, b) { 
		a = a- b* (Math.floor(a/ b));
		return (a < 0) ? a+ b : a;
	}
}

// Initialize PrayTimes with Makkah method (Umm Al-Qura) for Saudi Arabia
var prayTimes = new PrayTimes('Makkah');

const KFUPM_LAT = 26.3137222;
const KFUPM_LNG = 50.1461389;

let currentLang = 'ar';
let showAdvanced = false;
let showSettings = false;
let timeFormat = '12';
let iqamaTimes = { fajr: 30, dhuhr: 20, asr: 20, maghrib: 15, isha: 20 };

const translations = {
    ar: {
        currentTimeLabel: 'الوقت الحالي', nextAthanLabel: 'بقي للأذان', nextIqamaLabel: 'بقي للإقامة',
        langBtn: 'English', advancedBtn: 'عرض متقدم', settingsBtnText: 'إعدادات',
        settingsTitle: 'الإعدادات', formatLabel: 'صيغة الوقت',
        fajrLabel: 'الفجر (د)', dhuhrLabel: 'الظهر (د)', asrLabel: 'العصر (د)', 
        maghribLabel: 'المغرب (د)', ishaLabel: 'العشاء (د)',
        prayerHeader: 'الصلاة', athanHeader: 'الأذان', iqamaHeader: 'الإقامة',
        fajr: 'الفجر', dhuhr: 'الظهر', jumaa: 'الجمعة', asr: 'العصر', 
        maghrib: 'المغرب', isha: 'العشاء', mosqueNote: 'مسجد علي بن أبي طالب',
        sunrise: 'الشروق', daytime: 'طول النهار', nighttime: 'طول الليل',
        midnight: 'منتصف الليل', lastThird: 'بداية الثلث الأخير', 
        sahar: 'بداية السحر (السدس الأخير)'
    },
    en: {
        currentTimeLabel: 'Current Time', nextAthanLabel: 'To Athan', nextIqamaLabel: 'To Iqama',
        langBtn: 'العربية', advancedBtn: 'Advanced', settingsBtnText: 'Settings',
        settingsTitle: 'Settings', formatLabel: 'Time Format',
        fajrLabel: 'Fajr (m)', dhuhrLabel: 'Dhuhr (m)', asrLabel: 'Asr (m)',
        maghribLabel: 'Maghrib (m)', ishaLabel: 'Isha (m)',
        prayerHeader: 'Prayer', athanHeader: 'Athan', iqamaHeader: 'Iqama',
        fajr: 'Fajr', dhuhr: 'Dhuhr', jumaa: 'Jumaa', asr: 'Asr',
        maghrib: 'Maghrib', isha: 'Isha', mosqueNote: 'Ali Ibn Abi Talib Mosque',
        sunrise: 'Sunrise', daytime: 'Day Length', nighttime: 'Night Length',
        midnight: 'Midnight', lastThird: 'Last Third', sahar: 'Sahar (Last Sixth)'
    }
};

function getHijriDate(date) {
    try {
        const formatter = new Intl.DateTimeFormat('ar-SA-u-ca-islamic', {
            day: 'numeric', month: 'long', year: 'numeric'
        });
        const parts = formatter.formatToParts(date);
        const day = parts.find(p => p.type === 'day').value;
        const month = parts.find(p => p.type === 'month').value;
        const year = parts.find(p => p.type === 'year').value;
        return { day, month, year };
    } catch (e) {
        return { day: '؟', month: '؟', year: '؟' };
    }
}

const gregorianMonths = {
    ar: ['يناير', 'فبراير', 'مارس', 'أبريل', 'مايو', 'يونيو', 'يوليو', 'أغسطس', 'سبتمبر', 'أكتوبر', 'نوفمبر', 'ديسمبر'],
    en: ['January', 'February', 'March', 'April', 'May', 'June', 'July', 'August', 'September', 'October', 'November', 'December']
};

function formatDurationArabic(totalMinutes) {
    const hours = Math.floor(totalMinutes / 60);
    const minutes = Math.floor(totalMinutes % 60);
    
    function getHourWord(h) {
        if (h === 1) return 'ساعة';
        if (h === 2) return 'ساعتان';
        if (h >= 3 && h <= 10) return 'ساعات';
        return 'ساعة';
    }
    
    function getMinuteWord(m) {
        if (m === 1) return 'دقيقة';
        if (m === 2) return 'دقيقتان';
        if (m >= 3 && m <= 10) return 'دقائق';
        return 'دقيقة';
    }
    
    let result = '';
    if (hours > 0) {
        result += hours + ' ' + getHourWord(hours);
        if (minutes > 0) result += ' و';
    }
    if (minutes > 0 || hours === 0) {
        result += minutes + ' ' + getMinuteWord(minutes);
    }
    return result;
}

function formatDurationEnglish(totalMinutes) {
    const hours = Math.floor(totalMinutes / 60);
    const minutes = Math.floor(totalMinutes % 60);
    
    let result = '';
    if (hours > 0) {
        result += hours + ' ' + (hours === 1 ? 'hour' : 'hours');
        if (minutes > 0) result += ' ';
    }
    if (minutes > 0 || hours === 0) {
        result += minutes + ' ' + (minutes === 1 ? 'minute' : 'minutes');
    }
    return result;
}

function timeStringToMinutes(timeStr) {
    if (!timeStr || timeStr === '-----') return null;
    const [time, suffix] = timeStr.split(' ');
    const [h, m] = time.split(':').map(Number);
    let hours = h;
    if (suffix) {
        if (suffix.toLowerCase() === 'pm' || suffix === 'م') {
            if (hours !== 12) hours += 12;
        } else if (hours === 12) {
            hours = 0;
        }
    }
    return hours * 60 + m;
}

function formatTime(timeStr, showSeconds = false) {
    if (!timeStr || timeStr === '-----') return '--:--';
    const mins = timeStringToMinutes(timeStr);
    if (mins === null) return '--:--';
    
    const now = new Date();
    const date = new Date(now);
    date.setHours(Math.floor(mins / 60), mins % 60, 0, 0);
    
    let h = date.getHours();
    const m = date.getMinutes();
    const s = date.getSeconds();
    
    if (showSeconds) {
        if (timeFormat === '12') {
            const suffix = currentLang === 'ar' ? (h >= 12 ? ' م' : ' ص') : (h >= 12 ? ' PM' : ' AM');
            h = h % 12 || 12;
            return `${String(h).padStart(2, '0')}:${String(m).padStart(2, '0')}:${String(s).padStart(2, '0')}${suffix}`;
        }
        return `${String(h).padStart(2, '0')}:${String(m).padStart(2, '0')}:${String(s).padStart(2, '0')}`;
    }
    
    if (timeFormat === '12') {
        const suffix = currentLang === 'ar' ? (h >= 12 ? ' م' : ' ص') : (h >= 12 ? ' PM' : ' AM');
        h = h % 12 || 12;
        return `${String(h).padStart(2, '0')}:${String(m).padStart(2, '0')}${suffix}`;
    }
    return `${String(h).padStart(2, '0')}:${String(m).padStart(2, '0')}`;
}

function formatCurrentTime() {
    const now = new Date();
    let h = now.getHours();
    const m = now.getMinutes();
    const s = now.getSeconds();
    
    if (timeFormat === '12') {
        const suffix = currentLang === 'ar' ? (h >= 12 ? ' م' : ' ص') : (h >= 12 ? ' PM' : ' AM');
        h = h % 12 || 12;
        return `${String(h).padStart(2, '0')}:${String(m).padStart(2, '0')}:${String(s).padStart(2, '0')}${suffix}`;
    }
    return `${String(h).padStart(2, '0')}:${String(m).padStart(2, '0')}:${String(s).padStart(2, '0')}`;
}


function updateDateDisplay() {
    const now = new Date();
    const hijri = getHijriDate(now);
    
    if (currentLang === 'ar') {
        const gregDate = `${now.getDate()} ${gregorianMonths.ar[now.getMonth()]} ${now.getFullYear()}`;
        const hijriDate = `${hijri.day} ${hijri.month} ${hijri.year} هـ`;
        document.getElementById('dateInfo').textContent = `${gregDate} - ${hijriDate}`;
    } else {
        const gregDate = `${gregorianMonths.en[now.getMonth()]} ${now.getDate()}, ${now.getFullYear()}`;
        const hijriDate = `${hijri.month} ${hijri.day}, ${hijri.year} AH`;
        document.getElementById('dateInfo').textContent = `${gregDate} - ${hijriDate}`;
    }
}

function updateDisplay() {
    const now = new Date();
    const times = prayTimes.getTimes(now, [KFUPM_LAT, KFUPM_LNG], 3, 0, 'Float');
    const isFriday = now.getDay() === 5;
    
    updateDateDisplay();
    
    const prayerData = [
        { name: translations[currentLang].fajr, time: times.fajr, key: 'fajr' },
        { name: isFriday ? translations[currentLang].jumaa : translations[currentLang].dhuhr, time: times.dhuhr, key: 'dhuhr' },
        { name: translations[currentLang].asr, time: times.asr, key: 'asr' },
        { name: translations[currentLang].maghrib, time: times.maghrib, key: 'maghrib' },
        { name: translations[currentLang].isha, time: times.isha, key: 'isha' }
    ];
    
    const currentMinutes = now.getHours() * 60 + now.getMinutes();
    let nextPrayer = null;
    let nextStatus = null;
    
    prayerData.forEach((prayer, idx) => {
        const athanMins = prayer.time * 60;
        const iqamaMins = athanMins + iqamaTimes[prayer.key];
        prayer.athanMins = athanMins;
        prayer.iqamaMins = iqamaMins;
        
        if (!nextPrayer) {
            if (currentMinutes < athanMins) {
                nextPrayer = prayer;
                nextStatus = 'before_athan';
            } else if (currentMinutes >= athanMins && currentMinutes < iqamaMins) {
                nextPrayer = prayer;
                nextStatus = 'before_iqama';
            }
        }
    });
    
    if (!nextPrayer) {
        const tomorrow = new Date(now);
        tomorrow.setDate(tomorrow.getDate() + 1);
        const tomorrowTimes = prayTimes.getTimes(tomorrow, [KFUPM_LAT, KFUPM_LNG], 3, 0, 'Float');
        nextPrayer = { name: translations[currentLang].fajr, time: tomorrowTimes.fajr, key: 'fajr', athanMins: tomorrowTimes.fajr * 60 + 1440, iqamaMins: tomorrowTimes.fajr * 60 + 1440 + iqamaTimes.fajr };
        nextStatus = 'before_athan';
    }
    
    const tbody = document.getElementById('prayerTableBody');
    tbody.innerHTML = '';
    
    prayerData.forEach(prayer => {
        const row = document.createElement('tr');
        if (nextPrayer && nextPrayer.key === prayer.key && nextPrayer.athanMins === prayer.athanMins) {
            row.classList.add('next-prayer');
        }
        
        const athanTime = prayTimes.getFormattedTime(prayer.time, timeFormat === '12' ? '12h' : '24h', currentLang === 'ar' ? ['ص', 'م'] : ['AM', 'PM']);
        const iqamaTime = prayTimes.getFormattedTime(prayer.time + iqamaTimes[prayer.key] / 60, timeFormat === '12' ? '12h' : '24h', currentLang === 'ar' ? ['ص', 'م'] : ['AM', 'PM']);
        
        row.innerHTML = `
            <td class="prayer-name">${prayer.name}</td>
            <td class="time">${athanTime}</td>
            <td class="time">${iqamaTime}</td>
        `;
        tbody.appendChild(row);
    });
    
    document.getElementById('currentTime').textContent = formatCurrentTime();
    
    if (nextStatus === 'before_athan') {
        const diff = nextPrayer.athanMins - currentMinutes;
        document.getElementById('nextAthan').textContent = currentLang === 'ar' ? formatDurationArabic(diff) : formatDurationEnglish(diff);
        const iqamaDiff = nextPrayer.iqamaMins - currentMinutes;
        document.getElementById('nextIqama').textContent = currentLang === 'ar' ? formatDurationArabic(iqamaDiff) : formatDurationEnglish(iqamaDiff);
    } else {
        document.getElementById('nextAthan').textContent = '--:--';
        const iqamaDiff = nextPrayer.iqamaMins - currentMinutes;
        document.getElementById('nextIqama').textContent = currentLang === 'ar' ? formatDurationArabic(iqamaDiff) : formatDurationEnglish(iqamaDiff);
    }
    
    if (showAdvanced) {
        const sunrise = times.sunrise * 60;
        const maghrib = times.maghrib * 60;
        const dayLength = maghrib - sunrise;
        const nightLength = 1440 - dayLength;
        
        const tomorrow = new Date(now);
        tomorrow.setDate(tomorrow.getDate() + 1);
        const tomorrowTimes = prayTimes.getTimes(tomorrow, [KFUPM_LAT, KFUPM_LNG], 3, 0, 'Float');
        const nextFajr = tomorrowTimes.fajr * 60 + 1440;
        const nightDuration = nextFajr - maghrib;
        
        const midnight = maghrib + nightDuration / 2;
        const lastThird = maghrib + (nightDuration * 2 / 3);
        const sahar = maghrib + (nightDuration * 5 / 6);
        
        const advancedData = [
            { label: translations[currentLang].sunrise, value: prayTimes.getFormattedTime(times.sunrise, timeFormat === '12' ? '12h' : '24h', currentLang === 'ar' ? ['ص', 'م'] : ['AM', 'PM']) },
            { label: translations[currentLang].daytime, value: currentLang === 'ar' ? formatDurationArabic(dayLength) : formatDurationEnglish(dayLength) },
            { label: translations[currentLang].nighttime, value: currentLang === 'ar' ? formatDurationArabic(nightLength) : formatDurationEnglish(nightLength) },
            { label: translations[currentLang].midnight, value: prayTimes.getFormattedTime(midnight / 60, timeFormat === '12' ? '12h' : '24h', currentLang === 'ar' ? ['ص', 'م'] : ['AM', 'PM']) },
            { label: translations[currentLang].lastThird, value: prayTimes.getFormattedTime(lastThird / 60, timeFormat === '12' ? '12h' : '24h', currentLang === 'ar' ? ['ص', 'م'] : ['AM', 'PM']) },
            { label: translations[currentLang].sahar, value: prayTimes.getFormattedTime(sahar / 60, timeFormat === '12' ? '12h' : '24h', currentLang === 'ar' ? ['ص', 'م'] : ['AM', 'PM']) }
        ];
        
        const grid = document.getElementById('advancedGrid');
        grid.innerHTML = '';
        advancedData.forEach(item => {
            const div = document.createElement('div');
            div.className = 'advanced-item';
            div.innerHTML = `<div class="advanced-label">${item.label}</div><div class="advanced-value">${item.value}</div>`;
            grid.appendChild(div);
        });
    }
}

function toggleLanguage() {
    currentLang = currentLang === 'ar' ? 'en' : 'ar';
    document.documentElement.lang = currentLang;
    document.documentElement.dir = currentLang === 'ar' ? 'rtl' : 'ltr';
    Object.keys(translations[currentLang]).forEach(key => {
        const el = document.getElementById(key);
        if (el) el.textContent = translations[currentLang][key];
    });
    const sel = document.getElementById('timeFormat');
    sel.innerHTML = currentLang === 'ar' ? '<option value="12">12 ساعة</option><option value="24">24 ساعة</option>' : '<option value="12">12 Hour</option><option value="24">24 Hour</option>';
    sel.value = timeFormat;
    updateDisplay();
    saveSettings();
}

function toggleAdvanced() {
    showAdvanced = !showAdvanced;
    document.getElementById('advancedSection').classList.toggle('hidden');
    updateDisplay();
}

function toggleSettings() {
    showSettings = !showSettings;
    document.getElementById('settingsPanel').classList.toggle('hidden');
    document.getElementById('settingsArrow').textContent = showSettings ? '▲' : '▼';
}

function saveSettings() {
    timeFormat = document.getElementById('timeFormat').value;
    iqamaTimes.fajr = parseInt(document.getElementById('fajrIqama').value) || 30;
    iqamaTimes.dhuhr = parseInt(document.getElementById('dhuhrIqama').value) || 20;
    iqamaTimes.asr = parseInt(document.getElementById('asrIqama').value) || 20;
    iqamaTimes.maghrib = parseInt(document.getElementById('maghribIqama').value) || 15;
    iqamaTimes.isha = parseInt(document.getElementById('ishaIqama').value) || 20;
    document.cookie = `prayerSettings=${JSON.stringify({lang: currentLang, timeFormat, iqamaTimes})}; path=/; max-age=31536000`;
    updateDisplay();
}

function loadSettings() {
    const cookies = document.cookie.split(';');
    for (const cookie of cookies) {
        const [name, value] = cookie.trim().split('=');
        if (name === 'prayerSettings') {
            try {
                const settings = JSON.parse(decodeURIComponent(value));
                if (settings.lang && settings.lang !== currentLang) {
                    currentLang = settings.lang;
                    document.documentElement.lang = currentLang;
                    document.documentElement.dir = currentLang === 'ar' ? 'rtl' : 'ltr';
                }
                if (settings.timeFormat) {
                    timeFormat = settings.timeFormat;
                    document.getElementById('timeFormat').value = timeFormat;
                }
                if (settings.iqamaTimes) {
                    iqamaTimes = settings.iqamaTimes;
                    document.getElementById('fajrIqama').value = iqamaTimes.fajr;
                    document.getElementById('dhuhrIqama').value = iqamaTimes.dhuhr;
                    document.getElementById('asrIqama').value = iqamaTimes.asr;
                    document.getElementById('maghribIqama').value = iqamaTimes.maghrib;
                    document.getElementById('ishaIqama').value = iqamaTimes.isha;
                }
            } catch (e) {}
            break;
        }
    }
}

loadSettings();
Object.keys(translations[currentLang]).forEach(key => {
    const el = document.getElementById(key);
    if (el) el.textContent = translations[currentLang][key];
});
updateDisplay();
setInterval(() => updateDisplay(), 1000);
    </script>
</body>
</html>
